<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fefin Calls</title>
<style>
    body {
        margin: 0;
        background: #111;
        font-family: Arial;
        color: white;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    header {
        background: #075E54;
        padding: 15px;
        font-size: 22px;
        font-weight: bold;
    }

    #container {
        padding: 20px;
        flex: 1;
    }

    input, textarea {
        width: 100%;
        margin-top: 10px;
        background: #222;
        border: 1px solid #444;
        padding: 8px;
        color: white;
        border-radius: 6px;
    }

    button {
        margin-top: 15px;
        padding: 10px;
        background: #25D366;
        border: none;
        width: 100%;
        font-size: 18px;
        border-radius: 6px;
        cursor: pointer;
    }
</style>
</head>
<body>
<header>Fefin WebRTC Init</header>

<div id="container">
    <h3>1. Generar tu Call Code</h3>
    <button onclick="generateCode()">Crear Código</button>
    <input id="callCode" readonly placeholder="Código de llamada">

    <h3>2. Crear offer (para Python)</h3>
    <button onclick="createOffer()">Generar Offer</button>
    <textarea id="offerBox" placeholder="Tu offer aparecerá aquí"></textarea>

    <h3>3. Pegar Answer de Python</h3>
    <textarea id="answerBox" placeholder="Pega aquí el Answer"></textarea>
    <button onclick="applyAnswer()">Aplicar Answer</button>
</div>

<script>
let pc = new RTCPeerConnection();

function generateCode() {
    let user = prompt("Tu nombre de usuario:");
    let id = Math.floor(Math.random() * 9000 + 1000);
    let code = `${user}_call${id}`;
    document.getElementById("callCode").value = code;
}

async function createOffer() {
    pc.onicecandidate = e => {
        if (e.candidate) {
            offerBox.value = JSON.stringify(pc.localDescription);
        }
    };

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    offerBox.value = JSON.stringify(offer);
}

async function applyAnswer() {
    let ans = JSON.parse(answerBox.value);
    await pc.setRemoteDescription(ans);
    alert("Answer aplicado correctamente");
}
</script>

</body>
</html>
